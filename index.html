<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Untitled</title>
  

</head>
<body>
<!-- partial:index.partial.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Cámara Profesional - TikTok Style</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    /* Reinicio básico */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      height: 100vh;
      background: linear-gradient(150deg, #000, #222);
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      position: relative;
      overflow: hidden;
    }

    .camera-app {
      position: fixed;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    #camera {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: brightness(1);
    }

    /* Controles superiores con look TikTok: transparencias, degradados y sombras */
    .controls-top {
      position: fixed;
      top: 30px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 2;
    }
    
    .controls-top button {
      background: rgba(0, 0, 0, 0.4);
      border: none;
      color: white;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      font-size: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      transition: transform 0.2s ease;
    }
    
    .controls-top button:active {
      transform: scale(0.95);
    }
    
    .controls-top button.active {
      color: #FEE440;
      background: rgba(0, 0, 0, 0.7);
    }
    
    #flash {
      display: none;
    }

    /* Controles inferiores: botón de captura estilo TikTok con degradado y efecto de glow */
    .controls-bottom {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2;
    }
    
    #captureButton {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(45deg, #F700A2, #00F0FF);
      padding: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.15s ease;
    }
    
    .capture-button-inner {
      width: 100%;
      height: 100%;
      background: #000;
      border-radius: 50%;
    }

    /* Botones adicionales (sin modificar especialmente el carrusel de filtros) */
    #filterButton, #galleryButton {
      background: transparent;
      border: none;
      color: white;
      font-size: 24px;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Barra de filtros (se mantiene igual según indicación) */
    .filters-panel {
      position: fixed;
      bottom: 120px;
      left: 0;
      right: 0;
      height: 90px;
      overflow-x: auto;
      white-space: nowrap;
      scrollbar-width: none;
      -ms-overflow-style: none;
      display: flex;
      align-items: center;
      justify-content: center;
      -webkit-overflow-scrolling: touch;
      z-index: 1;
      background: transparent;
      padding: 10px 0;
    }
    
    .filters-panel::-webkit-scrollbar {
      display: none;
    }
    
    .filters-container {
      display: flex;
      gap: 20px;
      padding: 0 10px;
    }
    
    .filter-row {
      display: flex;
      gap: 20px;
    }
    
    /* Botón de búsqueda y panel para filtros especiales */
    .search-container {
      position: relative;
    }
    
    #searchToggle {
      background: rgba(0, 0, 0, 0.4);
      border: none;
      color: white;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      font-size: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      transition: transform 0.2s ease;
    }
    
    #searchToggle:active {
      transform: scale(0.95);
    }
    
    .search-panel {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.98);
      padding: 20px;
      z-index: 1000;
      animation: fadeIn 0.3s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px auto;
      display: none;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .search-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding: 10px 0;
    }
    
    .search-header .close-search {
      background: none;
      border: none;
      font-size: 24px;
      color: #333;
      margin-right: 15px;
    }
    
    .trending-filters {
      margin-top: 20px;
    }
    
    .trending-filters h3 {
      color: #333;
      margin-bottom: 15px;
      font-size: 18px;
    }
    
    .effects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .effect-card {
      background: #f5f5f5;
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      color: #333;
    }
    
    .search-panel.active {
      display: block;
    }
    
    #filterSearch {
      width: 100%;
      padding: 8px 12px;
      border: none;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.2);
      color: #333;
      margin-bottom: 10px;
    }
    
    .search-results {
      max-height: 300px;
      overflow-y: auto;
    }
    
    /* Los estilos para los botones del carrusel (barra de filtros) se mantienen */
    .filter-btn {
      width: 65px;
      height: 65px;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.8);
      background-position: center;
      background-size: cover;
      color: white;
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      flex-shrink: 0;
      backdrop-filter: blur(5px);
      transition: all 0.2s ease;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
      position: relative;
      overflow: hidden;
    }
    
    .filter-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.4);
      z-index: 1;
    }
    
    .filter-btn span {
      position: relative;
      z-index: 2;
    }
    
    .filter-btn.active {
      border-color: #00f2ea;
      transform: scale(1.1);
      background: rgba(0, 242, 234, 0.2);
      transition: all 0.3s ease;
    }
  </style>
</head>
<body>
  <div class="camera-app">
    <video id="camera" autoplay playsinline></video>
    <canvas id="canvas" style="display: none;"></canvas>

    <div class="controls-top">
      <div class="search-container">
        <button id="searchToggle">
          <i class="fas fa-search"></i>
        </button>
        <div class="search-panel">
          <div class="search-header">
            <button class="close-search">
              <i class="fas fa-arrow-left"></i>
            </button>
            <input type="text" id="filterSearch" placeholder="Buscar filtros y efectos...">
          </div>
          <div class="spinner"></div>
          <div class="trending-filters">
            <h3>Tendencias</h3>
            <div class="effects-grid">
              <div class="effect-card" data-effect="rain">
                <i class="fas fa-cloud-rain"></i>
                <p>Lluvia</p>
              </div>
              <div class="effect-card" data-effect="snow">
                <i class="fas fa-snowflake"></i>
                <p>Nieve</p>
              </div>
              <div class="effect-card" data-effect="glitter">
                <i class="fas fa-sparkles"></i>
                <p>Brillo</p>
              </div>
              <div class="effect-card" data-effect="hearts">
                <i class="fas fa-heart"></i>
                <p>Corazones</p>
              </div>
            </div>
          </div>
          <div class="search-results"></div>
        </div>
      </div>
      <button id="switchCamera">
        <i class="fas fa-camera-rotate"></i>
      </button>
      <button id="flash" class="flash-btn">
        <i class="fas fa-bolt"></i>
      </button>
    </div>

    <div class="controls-bottom">
      <button id="captureButton">
        <div class="capture-button-inner"></div>
      </button>
    </div>

    <!-- La barra de filtros (carrusel) se mantiene sin cambios -->
    <div class="filters-panel" id="filtersPanel">
      <div class="filters-container">
        <button class="filter-btn" data-filter="normal">Normal</button>
        <button class="filter-btn" data-filter="sepia">Sepia</button>
        <button class="filter-btn" data-filter="grayscale">B/N</button>
        <button class="filter-btn" data-filter="contrast">Contraste</button>
        <button class="filter-btn" data-filter="brightness">Brillo</button>
        <button class="filter-btn" data-filter="blur">Blur</button>
        <button class="filter-btn" data-filter="vintage">Vintage</button>
        <button class="filter-btn" data-filter="warm">Cálido</button>
        <button class="filter-btn" data-filter="cold">Frío</button>
        <button class="filter-btn" data-filter="dramatic">Drama</button>
      </div>
    </div>
  </div>

  <script>
    let currentStream;
    let currentFilter = 'normal';
    let facingMode = 'environment';
    let flashEnabled = false;
    
    async function initCamera() {
      try {
        const constraints = {
          video: {
            facingMode: facingMode,
            width: { ideal: 1920 },
            height: { ideal: 1080 }
          }
        };
        currentStream = await navigator.mediaDevices.getUserMedia(constraints);
        const video = document.getElementById('camera');
        video.srcObject = currentStream;
      } catch (err) {
        console.error('Error al acceder a la cámara:', err);
      }
    }
    
    document.getElementById('switchCamera').addEventListener('click', async () => {
      if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
      }
      facingMode = facingMode === 'environment' ? 'user' : 'environment';
      await initCamera();
    
      const flashButton = document.getElementById('flash');
      flashButton.style.display = facingMode === 'environment' ? 'block' : 'none';
    });
    
    document.getElementById('flash').addEventListener('click', async () => {
      flashEnabled = !flashEnabled;
      const flashButton = document.getElementById('flash');
      flashButton.classList.toggle('active');
    
      if (currentStream) {
        const track = currentStream.getVideoTracks()[0];
        try {
          await track.applyConstraints({
            advanced: [{ torch: flashEnabled }]
          });
        } catch (err) {
          console.error('Flash no soportado en este dispositivo:', err);
          flashEnabled = false;
          flashButton.classList.remove('active');
        }
      }
    });
    
    // Gestión de deslizamiento para filtros
    let startX;
    let isDragging = false;
    const filtersPanel = document.getElementById('filtersPanel');
    const captureButton = document.getElementById('captureButton');
    let initialTouchX;
    
    let filterStartX = 0;
    let filterScrollLeft = 0;
    
    filtersPanel.addEventListener('touchstart', (e) => {
      filterStartX = e.touches[0].clientX - filtersPanel.offsetLeft;
      filterScrollLeft = filtersPanel.scrollLeft;
    });
    
    filtersPanel.addEventListener('touchmove', (e) => {
      if (!filterStartX) return;
      e.preventDefault();
      const x = e.touches[0].clientX - filtersPanel.offsetLeft;
      const walk = (filterStartX - x) * 2;
      filtersPanel.scrollLeft = filterScrollLeft + walk;
    });
    
    filtersPanel.addEventListener('touchend', () => {
      filterStartX = 0;
    
      // Encontrar el filtro más cercano al centro
      const filterButtons = document.querySelectorAll('.filter-btn');
      const centerX = filtersPanel.offsetWidth / 2;
      let closest = null;
      let closestDistance = Infinity;
    
      filterButtons.forEach(button => {
        const rect = button.getBoundingClientRect();
        const distance = Math.abs(rect.left + rect.width / 2 - centerX);
        if (distance < closestDistance) {
          closestDistance = distance;
          closest = button;
        }
      });
    
      if (closest) {
        closest.click();
        filtersPanel.scrollTo({
          left: closest.offsetLeft - (filtersPanel.offsetWidth - closest.offsetWidth) / 2,
          behavior: 'smooth'
        });
      }
    });
    
    // Agregar evento para deslizamiento horizontal en los filtros
    filtersPanel.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
      const filterButtons = document.querySelectorAll('.filter-btn');
      filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          currentFilter = btn.dataset.filter;
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          applyFilter();
        });
      });
    });
    
    filtersPanel.addEventListener('touchmove', (e) => {
      if (startX) {
        const currentX = e.touches[0].clientX;
        const diff = startX - currentX;
        const filterButtons = document.querySelectorAll('.filter-btn');
        const currentIndex = Array.from(filterButtons).findIndex(btn => btn.classList.contains('active'));
    
        if (Math.abs(diff) > 30) { // Umbral para cambiar filtro
          const newIndex = diff > 0 ? 
            Math.min(currentIndex + 1, filterButtons.length - 1) : 
            Math.max(currentIndex - 1, 0);
    
          const newFilter = filterButtons[newIndex];
          if (newFilter && newFilter.dataset.filter !== currentFilter) {
            currentFilter = newFilter.dataset.filter;
            filterButtons.forEach(b => b.classList.remove('active'));
            newFilter.classList.add('active');
            applyFilter();
            startX = currentX; // Resetear posición inicial
          }
        }
      }
    });
    
    document.addEventListener('touchend', () => {
      initialTouchX = null;
    });
    
    // Permitir deslizar horizontalmente dentro del panel de filtros con mouse
    let isScrolling = false;
    let scrollLeft;
    
    document.getElementById('filtersPanel').addEventListener('mousedown', (e) => {
      isScrolling = true;
      startX = e.pageX - document.getElementById('filtersPanel').offsetLeft;
      scrollLeft = document.getElementById('filtersPanel').scrollLeft;
    });
    
    document.getElementById('filtersPanel').addEventListener('mouseleave', () => {
      isScrolling = false;
    });
    
    document.getElementById('filtersPanel').addEventListener('mouseup', () => {
      isScrolling = false;
    });
    
    document.getElementById('filtersPanel').addEventListener('mousemove', (e) => {
      if (!isScrolling) return;
      e.preventDefault();
      const x = e.pageX - document.getElementById('filtersPanel').offsetLeft;
      const walk = (x - startX) * 2;
      document.getElementById('filtersPanel').scrollLeft = scrollLeft - walk;
    });
    
    const filterBackgrounds = {
      'normal': 'https://images.unsplash.com/photo-1503023345310-bd7c1de61c7d?w=300',
      'sepia': 'https://images.unsplash.com/photo-1542038784456-1ea8e935640e?w=300',
      'grayscale': 'https://images.unsplash.com/photo-1520531158340-44015069e78e?w=300',
      'contrast': 'https://images.unsplash.com/photo-1501426026826-31c667bdf23d?w=300',
      'brightness': 'https://images.unsplash.com/photo-1500964757637-c85e8a162699?w=300',
      'blur': 'https://images.unsplash.com/photo-1518791841217-8f162f1e1131?w=300',
      'vintage': 'https://images.unsplash.com/photo-1519681393784-d120267933ba?w=300',
      'warm': 'https://images.unsplash.com/photo-1520962922320-2038eebab146?w=300',
      'cold': 'https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=300',
      'dramatic': 'https://images.unsplash.com/photo-1454496522488-7a8e488e8606?w=300',
      'dreamy': 'https://images.unsplash.com/photo-1516483638261-f4dbaf036963?w=300',
      'retro': 'https://images.unsplash.com/photo-1533158326339-7f3cf2404354?w=300',
      'cinema': 'https://images.unsplash.com/photo-1478720568477-152d9b164e26?w=300',
      'sunset': 'https://images.unsplash.com/photo-1495616811223-4d98c6e9c869?w=300'
    };
    
    document.querySelectorAll('.filter-btn').forEach(btn => {
      const filterName = btn.dataset.filter;
      if (filterBackgrounds[filterName]) {
        btn.style.backgroundImage = `url(${filterBackgrounds[filterName]})`;
      }
      btn.innerHTML = `<span>${btn.textContent}</span>`;
    
      btn.addEventListener('click', () => {
        currentFilter = filterName;
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        applyFilter();
      });
    });
    
    const searchToggle = document.getElementById('searchToggle');
    const searchPanel = document.querySelector('.search-panel');
    const filterSearch = document.getElementById('filterSearch');
    
    // Efectos especiales
    let activeEffect = null;
    let particles = [];
    
    class Particle {
      constructor(type) {
        this.x = Math.random() * window.innerWidth;
        this.y = type === 'rain' ? -20 : -10;
        this.type = type;
        this.speed = type === 'rain' ? 15 : 2;
        this.angle = 0;
      }
    
      update() {
        if (this.type === 'rain') {
          this.y += this.speed;
          this.x += Math.sin(this.angle) * 2;
          this.angle += 0.01;
        } else if (this.type === 'snow') {
          this.y += this.speed;
          this.x += Math.sin(this.angle) * 2;
          this.angle += 0.02;
        }
      }
    }
    
    function updateParticles() {
      if (!activeEffect) return;
    
      const canvas = document.createElement('canvas');
      canvas.style.position = 'fixed';
      canvas.style.top = '0';
      canvas.style.left = '0';
      canvas.style.pointerEvents = 'none';
      canvas.style.zIndex = '1000';
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    
      const ctx = canvas.getContext('2d');
    
      if (particles.length < 100) {
        particles.push(new Particle(activeEffect));
      }
    
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    
      particles = particles.filter(p => p.y < window.innerHeight);
    
      particles.forEach(p => {
        p.update();
        if (p.type === 'rain') {
          ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
          ctx.fillRect(p.x, p.y, 2, 20);
        } else if (p.type === 'snow') {
          ctx.beginPath();
          ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
          ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
          ctx.fill();
        }
      });
    
      requestAnimationFrame(updateParticles);
    }
    
    searchToggle.addEventListener('click', () => {
      searchPanel.classList.add('active');
      document.getElementById('filtersPanel').style.display = 'none';
    });
    
    document.querySelector('.close-search').addEventListener('click', () => {
      searchPanel.classList.remove('active');
      document.getElementById('filtersPanel').style.display = 'flex';
    });
    
    let searchTimeout;
    filterSearch.addEventListener('input', (e) => {
      const spinner = document.querySelector('.spinner');
      spinner.style.display = 'block';
    
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        const searchTerm = e.target.value.toLowerCase();
        const filterButtons = document.querySelectorAll('.filter-btn');
    
        filterButtons.forEach(btn => {
          const filterName = btn.textContent.toLowerCase();
          if (filterName.includes(searchTerm)) {
            btn.style.display = '';
          } else {
            btn.style.display = 'none';
          }
        });
        spinner.style.display = 'none';
      }, 300);
    });
    
    // Cerrar panel de búsqueda al hacer clic fuera
    document.addEventListener('click', (e) => {
      if (!searchToggle.contains(e.target) && !searchPanel.contains(e.target)) {
        searchPanel.classList.remove('active');
        document.getElementById('filtersPanel').style.display = 'flex';
      }
    });
    
    function applyFilter() {
      const video = document.getElementById('camera');
      let filterValue = '';
    
      switch(currentFilter) {
        case 'sepia': filterValue = 'sepia(100%)'; break;
        case 'grayscale': filterValue = 'grayscale(100%)'; break;
        case 'contrast': filterValue = 'contrast(150%)'; break;
        case 'brightness': filterValue = 'brightness(150%)'; break;
        case 'blur': filterValue = 'blur(5px)'; break;
        case 'vintage': filterValue = 'sepia(80%) hue-rotate(-20deg)'; break;
        case 'warm': filterValue = 'saturate(150%) hue-rotate(10deg)'; break;
        case 'cold': filterValue = 'saturate(140%) hue-rotate(-10deg)'; break;
        case 'dramatic': filterValue = 'contrast(140%) saturate(150%)'; break;
        default: filterValue = 'none';
      }
    
      video.style.filter = filterValue;
    }
    
    let startY;
    let currentBrightness = 100;
    
    captureButton.addEventListener('touchstart', (e) => {
      startY = e.touches[0].clientY;
    });
    
    captureButton.addEventListener('touchmove', (e) => {
      if (startY) {
        const currentY = e.touches[0].clientY;
        const diff = startY - currentY;
    
        // Ajustar brillo basado en el deslizamiento vertical
        currentBrightness = Math.max(50, Math.min(150, currentBrightness + (diff / 2)));
        const video = document.getElementById('camera');
        video.style.filter = `${video.style.filter.replace(/brightness$begin:math:text$[^)]*$end:math:text$/, '')} brightness(${currentBrightness}%)`;
    
        startY = currentY;
      }
    });
    
    captureButton.addEventListener('touchend', () => {
      startY = null;
    });
    
    document.getElementById('captureButton').addEventListener('click', () => {
      const video = document.getElementById('camera');
      const canvas = document.getElementById('canvas');
      const context = canvas.getContext('2d');
    
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
    
      context.filter = window.getComputedStyle(video).filter;
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
    
      const image = canvas.toDataURL('image/jpeg', 1.0);
    
      // Crear un enlace temporal para descargar la imagen
      const link = document.createElement('a');
      link.href = image;
      link.download = 'foto_' + new Date().getTime() + '.jpg';
      link.click();
    
      // Efecto visual de captura
      captureButton.style.transform = 'scale(0.9)';
      setTimeout(() => {
        captureButton.style.transform = 'scale(1)';
      }, 150);
    });
    
    // Iniciar la cámara cuando cargue la página
    initCamera();
  </script>
</body>
</html>
<!-- partial -->
  
</body>
</html>
